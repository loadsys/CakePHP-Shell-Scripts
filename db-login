#!/usr/bin/env bash

#---------------------------------------------------------------------
usage ()
{
	cat <<EOT

${0##*/}
    Uses Cake's Config/database.php file to start a command line
    mysql session with the correct host, database, user and password.
    Should be run from the project root folder.

Usage:
    bin/${0##*/}


EOT

	exit 0
}
if [ "$1" = '-h' ]; then
	usage
fi


DIR="$( cd -P "$( dirname "$0" )"/.. >/dev/null 2>&1 && pwd )"
BIN_DIR="$DIR/bin"

# Holy yuck, but nothing else works!
eval $( ${BIN_DIR}/db-credentials )

CMD="mysql --host=${DB_HOST} --database=${DB_DATABASE} --user=${DB_LOGIN}"
PATTERN=" |'"

if [[ ${DB_PASSWORD} =~ ${PATTERN} ]]; then
	${CMD} -p"${DB_PASSWORD}"
elif [ -n "${DB_PASSWORD}" ]; then
	${CMD} -p${DB_PASSWORD}
else
	${CMD}
fi
